<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Timed Survey ‚Äì Risk Game</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #f6f6f6;
        display: flex;
        justify-content: center;
        padding: 40px 16px;
      }
      .container {
        background: #fff;
        max-width: 720px;
        width: 100%;
        border-radius: 12px;
        box-shadow: 0 12px 30px rgba(0, 0, 0, 0.05);
        padding: 32px;
      }
      h1 {
        margin-top: 0;
        font-size: 1.4rem;
      }
      p {
        line-height: 1.6;
        color: #111827;
      }
      .question-text {
        font-size: 1.1rem;
        margin-bottom: 20px;
        font-weight: 600;
      }
      .option {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 14px;
        cursor: pointer;
      }
      .controls {
        margin-top: 24px;
        display: flex;
        gap: 10px;
      }
      button {
        border: none;
        background: #111827;
        color: white;
        padding: 9px 16px;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 600;
      }
      button[disabled] {
        opacity: 0.4;
        cursor: not-allowed;
      }

      /* TIMER STYLES */
      .timer {
        margin: 12px auto 20px auto;
        max-width: 360px;
        text-align: center;
        padding: 0;
      }
      .timer-text {
        font-size: 1rem;
        font-weight: 600;
        color: #b91c1c;
        margin-bottom: 6px;
      }
      .timer-bar-outer {
        width: 100%;
        height: 12px;
        background: #fee2e2;
        border-radius: 999px;
        overflow: hidden;
        border: 1px solid #fecaca;
      }
      .timer-bar-inner {
        height: 100%;
        width: 100%;
        background: #ef4444;
        transition: width 0.1s linear;
      }

      .hidden {
        display: none;
      }
      .progress {
        font-size: 0.8rem;
        color: #6b7280;
        margin-bottom: 8px;
      }
      .done-screen {
        text-align: center;
      }
      .consent-screen,
      .info-section,
      .instructions-screen {
        text-align: left;
      }
      .consent-screen button,
      .info-section button,
      .instructions-screen button {
        margin-top: 16px;
      }
      .info-section p,
      .info-section ul,
      .instructions-screen p,
      .instructions-screen ul {
        line-height: 1.6;
      }

      /* ===== SCORE ANIMATION STYLES ===== */
      #score-wrapper {
        position: relative;
        margin-bottom: 8px;
        font-weight: 600;
        color: #111827;
      }

      /* Pulse on the total score */
      .score-pulse {
        animation: scorePulse 0.4s ease-out;
      }

      @keyframes scorePulse {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.1);
        }
        100% {
          transform: scale(1);
        }
      }

      /* Floating delta (+20 / -10) */
      .score-delta {
        position: absolute;
        right: 0;
        top: -2px;
        font-weight: 700;
        opacity: 0;
        pointer-events: none;
      }

      .score-delta.positive {
        color: #16a34a; /* green */
      }

      .score-delta.negative {
        color: #b91c1c; /* red */
      }

      .score-delta.show {
        animation: floatUpFade 0.8s ease-out forwards;
      }

      @keyframes floatUpFade {
        0% {
          opacity: 0;
          transform: translateY(4px);
        }
        20% {
          opacity: 1;
          transform: translateY(0);
        }
        100% {
          opacity: 0;
          transform: translateY(-10px);
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <!-- INFORMATION SHEET SECTION -->
      <div id="info-section" class="info-section">
        <h1>Participant Information Sheet</h1>

        <p>
          <strong>Project title:</strong> The Influence of Time Pressure on
          Risky Decision-Making: A Comparison Between Rare and Common Outcome
          Choices
        </p>

        <p>Dear participant,</p>

        <p>
          Thank you for your interest in taking part in our study. This study
          explores how people make decisions in different situations. Your
          participation will help us better understand general patterns in
          decision-making.
        </p>

        <h3>Your rights as a participant</h3>
        <p>
          Participation in this study is completely voluntary. You are free to
          withdraw at any time, without giving a reason and without any negative
          consequences. All responses are anonymous and used only for academic
          research purposes.
        </p>

        <h3>What will happen in the study</h3>

        <p>
          You will complete a short online survey consisting of 20
          decision-making questions, where you will choose between two options.
          Some of the questions have a time limit.
        </p>

        <h3>Data storage and handling</h3>
        <p>
          Your answers will be stored anonymously. No identifying information
          such as your name, email, or IP address will be collected. The data
          will be used only for educational and research purposes as part of a
          university project.
        </p>

        <h3>Risks and benefits</h3>
        <p>
          There are no known risks associated with this study. Some questions
          will involve short time limits, but there are no real consequences
          beyond the survey itself. While there is no direct personal benefit,
          your participation contributes to understanding human decision-making.
        </p>

        <h3>Contact information</h3>
        <p>
          If you have any questions about the study or your rights as a
          participant, please contact us at
        </p>
        <p>
          You can reach us via our university emails if you have any questions
          or concerns.
        </p>
        <ul>
          <li>Aya: s205466@dtu.dk</li>
          <li>Alec: s205427@dtu.dk</li>
          <li>Jawahir: s205414@dtu.dk</li>
        </ul>

        <p>When you are ready, please continue to the consent form below.</p>

        <div class="controls">
          <button id="continue-to-consent">Continue to Consent Form</button>
        </div>
      </div>

      <!-- CONSENT SCREEN -->
      <div id="consent-screen" class="consent-screen hidden">
        <h1>Participant Consent Form</h1>

        <p>
          <strong>Project Title:</strong> The Influence of Time Pressure on
          Risky Decision-Making: A Comparison Between Rare and Common Outcome
          Choices
        </p>

        <p>
          Before you begin, please read the following statements carefully. By
          ticking the box below and clicking ‚ÄúBegin Survey,‚Äù you confirm that
          you have understood the information and consent to participate in this
          study.
        </p>

        <h3>I confirm that:</h3>
        <ul>
          <li>
            I have read and understood the information provided about this
            study.
          </li>
          <li>I have the opportunity to ask questions.</li>
          <li>I agree to take part voluntarily.</li>
        </ul>

        <h3>I understand that:</h3>
        <ul>
          <li>I can withdraw at any time without consequences.</li>
          <li>
            My responses will be stored anonymously and used only for academic
            research.
          </li>
          <li>No identifying information will be collected.</li>
        </ul>

        <h3>I agree that:</h3>
        <ul>
          <li>
            My fully anonymous data may be analyzed for educational and
            scientific purposes.
          </li>
        </ul>

        <div
          class="controls"
          style="flex-direction: column; align-items: flex-start; gap: 12px"
        >
          <label
            style="
              display: flex;
              align-items: center;
              gap: 8px;
              font-size: 0.95rem;
            "
          >
            <input type="checkbox" id="consent-checkbox" />
            I have read the information above and I consent to participate.
          </label>
          <button id="agree-btn" disabled>Begin Instructions</button>
        </div>
      </div>

      <!-- INSTRUCTIONS SCREEN -->
      <div id="instructions-screen" class="instructions-screen hidden">
        <h1>Instructions - Please read before you start!</h1>
        <p>
          In this task, you will make a series of choices between two options.
          You will start with <strong>100 points</strong>, and your total can go
          up or down based on your choices.
        </p>
        <ul>
          <li>
            <strong>Safe option:</strong> gives a guaranteed change in points
            (for example, ‚Äú+15 points for sure‚Äù).
          </li>
          <li>
            <strong>Risky option:</strong> has a chance to give a higher gain,
            but sometimes nothing or even a loss. The outcome is based on the
            stated probability and is randomly determined each time.
          </li>
        </ul>
        <p><strong>Example:</strong></p>
        <p style="margin-left: 12px">
          Safe option: <em>‚ÄúTake +15 points for sure.‚Äù</em><br />
          Risky option:
          <em>‚Äú30% chance to win +60 points, 70% chance to win 0.‚Äù</em><br />
          If you choose the risky option, sometimes you will get +60 points,
          and sometimes you will get 0 points. This is decided randomly
          according to the percentages each time.
        </p>
        <p>
          Some questions will have a <strong>time limit</strong>. A timer and a
          bar will appear on the screen and count down. If you do not answer in
          time, the question will be marked as ‚ÄúNo answer (timed out)‚Äù and you
          will automatically move on to the next one.
        </p>
        <p>
          Please answer as honestly as you can. There are no right or wrong
          answers. The points are only used for this task and do not correspond
          to real money.
        </p>
        <div class="controls">
          <button id="start-game-btn">I am ready to start</button>
        </div>
      </div>

      <!-- SURVEY SCREEN -->
      <div id="survey-area" class="hidden">
        <h1>Survey</h1>

        <!-- SCORE WRAPPER WITH DELTA -->
        <div id="score-wrapper">
          <div id="score-display">Total points: 100</div>
          <div id="score-delta" class="score-delta hidden"></div>
        </div>

        <div class="progress" id="progress"></div>

        <!-- TIMER IN THE MIDDLE -->
        <div id="timer" class="timer hidden">
          <div id="timer-text" class="timer-text"></div>
          <div class="timer-bar-outer">
            <div id="timer-bar-inner" class="timer-bar-inner"></div>
          </div>
        </div>

        <div class="question-text" id="question-text"></div>
        <div id="options"></div>
        <div
          id="outcome-text"
          style="margin-top: 12px; color: #4b5563; min-height: 1.2em"
        ></div>
        <div class="controls">
          <button id="next-btn" disabled>Next</button>
        </div>
      </div>

      <!-- DONE SCREEN -->
      <div id="done" class="done-screen hidden" style="text-align: center">
        <div
          style="
            background: #f9fafb;
            border-radius: 12px;
            padding: 40px 30px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.05);
            animation: fadeIn 0.8s ease-in-out;
          "
        >
          <h2 style="font-size: 1.6rem; margin-bottom: 10px">
            üéâ Thank you for participating!
          </h2>

          <p style="font-size: 1rem; color: #1f2937; margin-bottom: 24px">
            Your responses have been securely recorded.
          </p>

          <p
            style="
              font-size: 1.05rem;
              line-height: 1.8;
              color: #111827;
              max-width: 600px;
              margin: 0 auto 24px auto;
            "
          >
            This study explores how people make decisions in different
            situations, including under time pressure. Your participation helps
            us better understand general patterns in decision-making.
          </p>

          <p style="font-style: italic; color: #4b5563">
            We sincerely appreciate your time and contribution.
          </p>
        </div>
      </div>

      <script>
        // ============= CONFIGURATION =============

        const baseScore = 100; // starting points for everyone

        // 20 trials total: 10 rare (5 timed, 5 untimed), 10 common (5 timed, 5 untimed)
        const trialPool = [
          // ===== RARE, TIMED (5) =====
          {
            rarity: "rare",
            timed: true,
            time: 10,
            text: "You can take a safe gain, or a rare chance at a much larger gain.",
            safeLabel: "Take +20 points for sure",
            riskyLabel: "20% chance to win +80 points, 80% chance to win 0",
            safeDelta: 20,
            riskyProb: 0.2,
            riskyWin: 80,
            riskyLose: 0,
          },
          {
            rarity: "rare",
            timed: true,
            time: 10,
            text: "You can keep a small safe bonus, or risk it for a rare big reward.",
            safeLabel: "Take +15 points for sure",
            riskyLabel: "15% chance to win +90 points, 85% chance to win 0",
            safeDelta: 15,
            riskyProb: 0.15,
            riskyWin: 90,
            riskyLose: 0,
          },
          {
            rarity: "rare",
            timed: true,
            time: 10,
            text: "You may choose a modest gain or a rare gamble with a high upside.",
            safeLabel: "Take +10 points for sure",
            riskyLabel: "10% chance to win +100 points, 90% chance to win 0",
            safeDelta: 10,
            riskyProb: 0.1,
            riskyWin: 100,
            riskyLose: 0,
          },
          {
            rarity: "rare",
            timed: true,
            time: 10,
            text: "You can choose a safe small reward or a risky option that might greatly boost your points.",
            safeLabel: "Take +12 points for sure",
            riskyLabel: "12% chance to win +120 points, 88% chance to win 0",
            safeDelta: 12,
            riskyProb: 0.12,
            riskyWin: 120,
            riskyLose: 0,
          },
          {
            rarity: "rare",
            timed: true,
            time: 10,
            text: "You can keep your points stable or risk them for a rare large gain but possible loss.",
            safeLabel: "Take +8 points for sure",
            riskyLabel: "10% chance to win +80, 90% chance to lose -20",
            safeDelta: 8,
            riskyProb: 0.1,
            riskyWin: 80,
            riskyLose: -20,
          },

          // ===== RARE, UNTIMED (5) =====
          {
            rarity: "rare",
            timed: false,
            text: "You can take a small safe gain, or risk some points for a rare big boost.",
            safeLabel: "Take +10 points for sure",
            riskyLabel: "10% chance to win +100, 90% chance to lose -10",
            safeDelta: 10,
            riskyProb: 0.1,
            riskyWin: 100,
            riskyLose: -10,
          },
          {
            rarity: "rare",
            timed: false,
            text: "Choose between a guaranteed bonus or a rare chance at a huge gain with possible loss.",
            safeLabel: "Take +15 points for sure",
            riskyLabel: "8% chance to win +120, 92% chance to lose -15",
            safeDelta: 15,
            riskyProb: 0.08,
            riskyWin: 120,
            riskyLose: -15,
          },
          {
            rarity: "rare",
            timed: false,
            text: "You can secure a small win or gamble on a rare but large reward.",
            safeLabel: "Take +12 points for sure",
            riskyLabel: "5% chance to win +150, 95% chance to lose -5",
            safeDelta: 12,
            riskyProb: 0.05,
            riskyWin: 150,
            riskyLose: -5,
          },
          {
            rarity: "rare",
            timed: false,
            text: "You can lock in a modest gain or risk losing some points for a small chance at a jackpot.",
            safeLabel: "Take +10 points for sure",
            riskyLabel: "4% chance to win +200, 96% chance to lose -20",
            safeDelta: 10,
            riskyProb: 0.04,
            riskyWin: 200,
            riskyLose: -20,
          },
          {
            rarity: "rare",
            timed: false,
            text: "You can stay safe with a small gain, or risk points for a rare large increase.",
            safeLabel: "Take +8 points for sure",
            riskyLabel: "5% chance to win +120, 95% chance to lose -10",
            safeDelta: 8,
            riskyProb: 0.05,
            riskyWin: 120,
            riskyLose: -10,
          },

          // ===== COMMON, TIMED (5) =====
          {
            rarity: "common",
            timed: true,
            time: 10,
            text: "You can take a sure gain, or choose an option that usually gives a higher reward.",
            safeLabel: "Take +15 points for sure",
            riskyLabel: "70% chance to win +30, 30% chance to win 0",
            safeDelta: 15,
            riskyProb: 0.7,
            riskyWin: 30,
            riskyLose: 0,
          },
          {
            rarity: "common",
            timed: true,
            time: 10,
            text: "Choose between a safe moderate gain and a common higher reward.",
            safeLabel: "Take +18 points for sure",
            riskyLabel: "80% chance to win +25, 20% chance to win 0",
            safeDelta: 18,
            riskyProb: 0.8,
            riskyWin: 25,
            riskyLose: 0,
          },
          {
            rarity: "common",
            timed: true,
            time: 10,
            text: "You can secure points or choose a risky option that usually increases your total.",
            safeLabel: "Take +12 points for sure",
            riskyLabel: "75% chance to win +28, 25% chance to win 0",
            safeDelta: 12,
            riskyProb: 0.75,
            riskyWin: 28,
            riskyLose: 0,
          },
          {
            rarity: "common",
            timed: true,
            time: 10,
            text: "Choose between a safe small gain and a common higher reward gamble.",
            safeLabel: "Take +10 points for sure",
            riskyLabel: "65% chance to win +35, 35% chance to win 0",
            safeDelta: 10,
            riskyProb: 0.65,
            riskyWin: 35,
            riskyLose: 0,
          },
          {
            rarity: "common",
            timed: true,
            time: 10,
            text: "You can keep a sure reward or pick an option that usually gives you more points.",
            safeLabel: "Take +14 points for sure",
            riskyLabel: "70% chance to win +32, 30% chance to win 0",
            safeDelta: 14,
            riskyProb: 0.7,
            riskyWin: 32,
            riskyLose: 0,
          },

          // ===== COMMON, UNTIMED (5) =====
          {
            rarity: "common",
            timed: false,
            text: "You can accept a guaranteed small gain or choose a gamble that often gives higher rewards.",
            safeLabel: "Take +12 points for sure",
            riskyLabel: "80% chance to win +22, 20% chance to win 0",
            safeDelta: 12,
            riskyProb: 0.8,
            riskyWin: 22,
            riskyLose: 0,
          },
          {
            rarity: "common",
            timed: false,
            text: "You may choose a sure reward, or a common gamble with a better outcome.",
            safeLabel: "Take +15 points for sure",
            riskyLabel: "75% chance to win +25, 25% chance to win 0",
            safeDelta: 15,
            riskyProb: 0.75,
            riskyWin: 25,
            riskyLose: 0,
          },
          {
            rarity: "common",
            timed: false,
            text: "You can take a stable small gain or choose a risky option that usually pays more.",
            safeLabel: "Take +10 points for sure",
            riskyLabel: "70% chance to win +30, 30% chance to win 0",
            safeDelta: 10,
            riskyProb: 0.7,
            riskyWin: 30,
            riskyLose: 0,
          },
          {
            rarity: "common",
            timed: false,
            text: "Choose between a sure small bonus or a gamble that often increases your points.",
            safeLabel: "Take +8 points for sure",
            riskyLabel: "65% chance to win +28, 35% chance to win 0",
            safeDelta: 8,
            riskyProb: 0.65,
            riskyWin: 28,
            riskyLose: 0,
          },
          {
            rarity: "common",
            timed: false,
            text: "You can secure a modest gain or choose an option that usually gives a higher reward.",
            safeLabel: "Take +14 points for sure",
            riskyLabel: "80% chance to win +20, 20% chance to win 0",
            safeDelta: 14,
            riskyProb: 0.8,
            riskyWin: 20,
            riskyLose: 0,
          },
        ];

        function shuffle(array) {
          return array
            .map((x) => ({ x, r: Math.random() }))
            .sort((a, b) => a.r - b.r)
            .map((o) => o.x);
        }

        const questions = shuffle(trialPool); // randomized trials

        // ============= DOM ELEMENTS =============
        const infoSection = document.getElementById("info-section");
        const consentScreen = document.getElementById("consent-screen");
        const instructionsScreen = document.getElementById(
          "instructions-screen"
        );
        const surveyArea = document.getElementById("survey-area");
        const doneScreen = document.getElementById("done");

        const continueBtn = document.getElementById("continue-to-consent");
        const agreeBtn = document.getElementById("agree-btn");
        const consentCheckbox = document.getElementById("consent-checkbox");
        const startGameBtn = document.getElementById("start-game-btn");

        const qTextEl = document.getElementById("question-text");
        const optionsEl = document.getElementById("options");
        const nextBtn = document.getElementById("next-btn");
        const progressEl = document.getElementById("progress");
        const timerEl = document.getElementById("timer");
        const timerTextEl = document.getElementById("timer-text");
        const timerBarFill = document.getElementById("timer-bar-inner");
        const scoreEl = document.getElementById("score-display");
        const scoreDeltaEl = document.getElementById("score-delta");
        const outcomeTextEl = document.getElementById("outcome-text");

        // ============= STATE =============
        let score = baseScore;
        let currentIndex = 0;
        let answers = [];
        let selectedOption = null; // "safe" or "risky"
        let countdownId = null;
        let timeLeft = 0;
        let totalTime = 0;

        const endpoint =
          "https://script.google.com/macros/s/AKfycbw2cqBNTl5aO8LJwN0UxmTbf-FCC1uyEbuoJVDs824a0QviiO00oHNbpEhpzQzwXx1_/exec";

        // ============= FLOW =============
        continueBtn.addEventListener("click", () => {
          infoSection.classList.add("hidden");
          consentScreen.classList.remove("hidden");
        });

        consentCheckbox.addEventListener("change", () => {
          agreeBtn.disabled = !consentCheckbox.checked;
        });

        // After consent, show INSTRUCTIONS first
        agreeBtn.addEventListener("click", () => {
          consentScreen.classList.add("hidden");
          instructionsScreen.classList.remove("hidden");
        });

        // From instructions to actual game
        startGameBtn.addEventListener("click", () => {
          instructionsScreen.classList.add("hidden");
          surveyArea.classList.remove("hidden");
          score = baseScore;
          updateScoreDisplay();
          showQuestion(currentIndex);
        });

        function updateScoreDisplay() {
          scoreEl.textContent = `Total points: ${score}`;
        }

        function showScoreAnimation(delta) {
          if (delta == null || delta === 0) return;

          // pulse the total score
          scoreEl.classList.remove("score-pulse");
          void scoreEl.offsetWidth; // force reflow so animation restarts
          scoreEl.classList.add("score-pulse");

          // floating delta
          scoreDeltaEl.classList.remove("hidden", "positive", "negative", "show");
          const sign = delta > 0 ? "+" : "";
          scoreDeltaEl.textContent = `${sign}${delta}`;
          scoreDeltaEl.classList.add(delta > 0 ? "positive" : "negative");
          scoreDeltaEl.classList.add("show");

          // remove "show" after animation
          setTimeout(() => {
            scoreDeltaEl.classList.remove("show");
          }, 900);
        }

        function showQuestion(index) {
          const q = questions[index];
          qTextEl.textContent = q.text;
          progressEl.textContent = `Question ${index + 1} of ${
            questions.length
          }`;
          outcomeTextEl.textContent = "";
          optionsEl.innerHTML = "";

          // Safe option
          const safeLabel = document.createElement("label");
          safeLabel.className = "option";
          const safeInput = document.createElement("input");
          safeInput.type = "radio";
          safeInput.name = "option";
          safeInput.value = "safe";
          safeInput.addEventListener("change", () => {
            selectedOption = "safe";
            nextBtn.disabled = false;
          });
          const safeSpan = document.createElement("span");
          safeSpan.textContent = q.safeLabel;
          safeLabel.appendChild(safeInput);
          safeLabel.appendChild(safeSpan);
          optionsEl.appendChild(safeLabel);

          // Risky option
          const riskyLabel = document.createElement("label");
          riskyLabel.className = "option";
          const riskyInput = document.createElement("input");
          riskyInput.type = "radio";
          riskyInput.name = "option";
          riskyInput.value = "risky";
          riskyInput.addEventListener("change", () => {
            selectedOption = "risky";
            nextBtn.disabled = false;
          });
          const riskySpan = document.createElement("span");
          riskySpan.textContent = q.riskyLabel;
          riskyLabel.appendChild(riskyInput);
          riskyLabel.appendChild(riskySpan);
          optionsEl.appendChild(riskyLabel);

          selectedOption = null;
          nextBtn.disabled = true;

          clearInterval(countdownId);
          if (q.timed) {
            const secs = typeof q.time === "number" ? q.time : 10;
            startTimer(secs);
          } else {
            timerEl.classList.add("hidden");
          }
        }

        function startTimer(seconds) {
          timeLeft = seconds;
          totalTime = seconds;
          timerEl.classList.remove("hidden");
          timerTextEl.textContent = `Time left: ${timeLeft}s`;
          timerBarFill.style.width = "100%";

          clearInterval(countdownId);
          countdownId = setInterval(() => {
            timeLeft--;
            if (timeLeft >= 0) {
              timerTextEl.textContent = `Time left: ${timeLeft}s`;
              const pct = (timeLeft / totalTime) * 100;
              timerBarFill.style.width = pct + "%";
            }

            if (timeLeft <= 0) {
              clearInterval(countdownId);
              if (!selectedOption) {
                // timeout
                recordAnswer("No answer (timed out)", null);
                goNext();
              } else {
                submitCurrentAndNext();
              }
            }
          }, 1000);
        }

        function recordAnswer(choiceLabel, outcomeDelta) {
          const q = questions[currentIndex];
          answers.push({
            questionIndex: currentIndex,
            questionText: q.text,
            rarity: q.rarity,
            timed: q.timed,
            choice: choiceLabel, // "safe", "risky", or timeout string
            outcomeDelta: outcomeDelta,
            totalScoreAfter: score,
          });
        }

        function submitCurrentAndNext() {
          const q = questions[currentIndex];
          let outcomeDelta = 0;
          let choiceLabel = selectedOption;

          if (selectedOption === "safe") {
            outcomeDelta = q.safeDelta;
          } else if (selectedOption === "risky") {
            const r = Math.random();
            if (r < q.riskyProb) {
              outcomeDelta = q.riskyWin;
            } else {
              outcomeDelta = q.riskyLose;
            }
          }

          score += outcomeDelta;
          updateScoreDisplay();
          showScoreAnimation(outcomeDelta);

          if (selectedOption) {
            const sign = outcomeDelta > 0 ? "+" : "";
            outcomeTextEl.textContent = `Outcome: ${sign}${outcomeDelta} points. New total: ${score}`;
          }

          recordAnswer(choiceLabel, outcomeDelta);
          goNext();
        }

        function goNext() {
          currentIndex++;
          if (currentIndex >= questions.length) {
            finishSurvey();
          } else {
            clearInterval(countdownId);
            showQuestion(currentIndex);
          }
        }

        async function finishSurvey() {
          clearInterval(countdownId);
          surveyArea.classList.add("hidden");
          doneScreen.classList.remove("hidden");

          try {
            await fetch(endpoint, {
              method: "POST",
              mode: "no-cors",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(answers),
            });
          } catch (err) {
            console.error("Error sending responses:", err);
          }
        }

        nextBtn.addEventListener("click", () => {
          clearInterval(countdownId);
          if (!selectedOption) return;
          submitCurrentAndNext();
        });
      </script>
    </div>
  </body>
</html>
